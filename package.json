{
  "name": "aws-serverless-dev-portal-example",
  "version": "1.0.0",
  "description": "Example application for running a Serverless Developer Portal with API Gateway and Lambda",
  "main": "lambda.js",
  "config": {
    "artifactsS3Bucket": "brett-dev-portal-artifacts",
    "siteS3Bucket": "brett-dev-portal-app",
    "accountId": "347971939225",
    "primaryAwsRegion": "us-east-1",
    "cloudFormationStackName": "DeveloperPortal",
    "apiGatewayApiName": "Developer Portal",
    "customersTableName": "DevPortalCustomers",
    "identityPoolName": "DevPortal",
    "apiGatewayApiId": "8bfg5zkec4",
    "cognitoRegion": "us-east-1",
    "cognitoUserPoolId": "us-east-1_8M1tvuIV8",
    "cognitoClientId": "6cpmle8j5kdmt7qrlj2aid43bc",
    "cognitoIdentityPoolId": "us-east-1:93c008a9-adaf-442d-8da2-1f00b539bcd0",
    "listenerLambdaFunctionName": "DevPortalSubscriptionListener",
    "marketplaceSubscriptionTopic": "arn:aws:sns:us-east-1:287250355862:aws-mp-subscription-notification-PRODUCT_CODE"
  },
  "scripts": {
    "pre-config": "node scripts/pre-configure.js",
    "post-config": "node scripts/post-configure.js",
    "deconfig": "node -e \"require('./scripts/deconfigure.js')()\"",
    "package": "aws cloudformation package --template cloudformation/base.yaml --s3-bucket $npm_package_config_artifactsS3Bucket --output-template packaged-sam.yaml --region $npm_package_config_primaryAwsRegion",
    "deploy": "aws cloudformation deploy --template-file packaged-sam.yaml --stack-name $npm_package_config_cloudFormationStackName --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM --parameter-overrides ArtifactsS3Bucket=$npm_package_config_artifactsS3Bucket DevPortalSiteS3Bucket=$npm_package_config_siteS3Bucket MarketplaceSubscriptionTopic=$npm_package_config_marketplaceSubscriptionTopic CognitoIdentityPoolName=$npm_package_config_identityPoolName DevPortalCustomersTableName=$npm_package_config_customersTableName --region $npm_package_config_primaryAwsRegion",
    "package-deploy": "npm run package && npm run deploy",
    "create-artifacts-bucket": "aws s3api get-bucket-location --bucket $npm_package_config_artifactsS3Bucket --region $npm_package_config_primaryAwsRegion || aws s3 mb s3://$npm_package_config_artifactsS3Bucket --region $npm_package_config_primaryAwsRegion",
    "delete-artifacts-bucket": "aws s3 rm s3://$npm_package_config_artifactsS3Bucket/lambda-function.zip --region $npm_package_config_primaryAwsRegion; aws s3 rm s3://$npm_package_config_artifactsS3Bucket/dev-portal-express-proxy-api.yaml --region $npm_package_config_primaryAwsRegion; aws s3 rb s3://$npm_package_config_artifactsS3Bucket --region $npm_package_config_primaryAwsRegion",
    "upload-site": "cd ./dev-portal && npm run build && aws s3 sync ./build s3://$npm_package_config_siteS3Bucket --grants read=uri=http://acs.amazonaws.com/groups/global/AllUsers --region $npm_package_config_primaryAwsRegion && cd ..",
    "delete-stack": "aws cloudformation delete-stack --stack-name $npm_package_config_cloudFormationStackName --region $npm_package_config_primaryAwsRegion",
    "lambdas-npm-install": "cd lambdas/backend && npm install && cd meteringservice-preview-sdk-js-06-23-2016 && npm install && cd ../../listener && npm install && cd ../cognito-cloudformation-custom-resource && npm install && cd ../..",
    "subscribe-listener": "aws sns subscribe --topic-arn $npm_package_config_marketplaceSubscriptionTopic --protocol lambda --notification-endpoint arn:aws:lambda:$npm_package_config_primaryAwsRegion:$npm_package_config_accountId:function:$npm_package_config_listenerLambdaFunctionName --region us-east-1",
    "setup": "npm install && npm run pre-config && npm run create-artifacts-bucket && npm run lambdas-npm-install && npm run package-deploy && npm run post-setup",
    "post-setup": "npm run post-config && cd dev-portal && npm install && npm run upload-site && npm home",
    "clean": "npm run delete-artifacts-bucket && npm run delete-stack",

    "win-pre-config": "node scripts/pre-configure.js",
    "win-post-config": "node scripts/post-configure.js",
    "win-deconfig": "node -e \"require('./scripts/deconfigure.js')()\"",
    "win-package": "aws cloudformation package --template cloudformation/base.yaml --s3-bucket %npm_package_config_artifactsS3Bucket% --output-template packaged-sam.yaml --region %npm_package_config_primaryAwsRegion%",
    "win-deploy": "aws cloudformation deploy --template-file packaged-sam.yaml --stack-name %npm_package_config_cloudFormationStackName% --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM --parameter-overrides ArtifactsS3Bucket=%npm_package_config_artifactsS3Bucket% DevPortalSiteS3Bucket=%npm_package_config_siteS3Bucket% MarketplaceSubscriptionTopic=%npm_package_config_marketplaceSubscriptionTopic% CognitoIdentityPoolName=%npm_package_config_identityPoolName% DevPortalCustomersTableName=%npm_package_config_customersTableName% --region %npm_package_config_primaryAwsRegion%",
    "win-package-deploy": "npm run win-package && npm run win-deploy",
    "win-create-artifacts-bucket": "aws s3api get-bucket-location --bucket %npm_package_config_artifactsS3Bucket% --region %npm_package_config_primaryAwsRegion% || aws s3 mb s3://%npm_package_config_artifactsS3Bucket% --region %npm_package_config_primaryAwsRegion%",
    "win-delete-artifacts-bucket": "aws s3 rm s3://%npm_package_config_artifactsS3Bucket%/lambda-function.zip --region %npm_package_config_primaryAwsRegion%; aws s3 rm s3://%npm_package_config_artifactsS3Bucket%/dev-portal-express-proxy-api.yaml --region %npm_package_config_primaryAwsRegion%; aws s3 rb s3://%npm_package_config_artifactsS3Bucket% --region %npm_package_config_primaryAwsRegion%",
    "win-upload-site": "cd ./dev-portal && npm run build && aws s3 sync ./build s3://%npm_package_config_siteS3Bucket% --grants read=uri=http://acs.amazonaws.com/groups/global/AllUsers --region %npm_package_config_primaryAwsRegion% && cd ..",
    "win-delete-stack": "aws cloudformation delete-stack --stack-name %npm_package_config_cloudFormationStackName% --region %npm_package_config_primaryAwsRegion%",
    "win-lambdas-npm-install": "cd lambdas/backend && npm install && cd meteringservice-preview-sdk-js-06-23-2016 && npm install && cd ../../listener && npm install && cd ../cognito-cloudformation-custom-resource && npm install && cd ../..",
    "win-subscribe-listener": "aws sns subscribe --topic-arn %npm_package_config_marketplaceSubscriptionTopic% --protocol lambda --notification-endpoint arn:aws:lambda:%npm_package_config_primaryAwsRegion%:%npm_package_config_accountId%:function:%npm_package_config_listenerLambdaFunctionName% --region us-east-1",
    "win-setup": "npm install && npm run win-pre-config && npm run win-create-artifacts-bucket && npm run win-lambdas-npm-install && npm run win-package-deploy && npm run win-post-setup",
    "win-post-setup": "npm run win-post-config && cd dev-portal && npm install && npm run win-upload-site && npm home",
    "win-clean": "npm run win-delete-artifacts-bucket && npm run win-delete-stack"

  },
  "license": "Apache-2.0",
  "dependencies": {
    "aws-sdk": "^2.7.8"
  },
  "devDependencies": {
    "inquirer": "^1.2.1"
  }
}
